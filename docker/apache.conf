# ==========================================
# üåê CONFIGURATION APACHE - EcoRide
# ==========================================
# Configuration pour Docker (PHP 8.2 + Apache)

<VirtualHost *:80>
    # ==========================================
    # üìÇ CHEMINS DE BASE
    # ==========================================
    ServerAdmin admin@ecoride.local
    DocumentRoot /var/www/html
    
    # ==========================================
    # üìÅ CONFIGURATION DU R√âPERTOIRE
    # ==========================================
    <Directory /var/www/html>
        # Autoriser l'acc√®s
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Index par d√©faut
        DirectoryIndex index.php index.html
        
        # ==========================================
        # üîÑ URL REWRITING (si .htaccess existe)
        # ==========================================
        <IfModule mod_rewrite.c>
            RewriteEngine On
            
            # Rediriger vers index.php si le fichier n'existe pas
            # RewriteCond %{REQUEST_FILENAME} !-f
            # RewriteCond %{REQUEST_FILENAME} !-d
            # RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
        </IfModule>
    </Directory>
    
    # ==========================================
    # üìä LOGS
    # ==========================================
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # ==========================================
    # üêò CONFIGURATION PHP
    # ==========================================
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>
    
    # ==========================================
    # üîê S√âCURIT√â
    # ==========================================
    # Masquer la version Apache
    ServerSignature Off
    
    # D√©sactiver listage des r√©pertoires (optionnel)
    # Options -Indexes
    
    # Protection des fichiers sensibles
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    # Protection des fichiers de configuration
    <FilesMatch "\.(env|sql|json|md)$">
        Require all denied
    </FilesMatch>
    
    # ==========================================
    # üì¶ COMPRESSION GZIP (performance)
    # ==========================================
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>
    
    # ==========================================
    # üöÄ CACHE (performance)
    # ==========================================
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Images
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        
        # CSS et JavaScript
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        
        # Fonts
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
    </IfModule>
    
</VirtualHost>

# ==========================================
# üîß CONFIGURATION GLOBALE PHP
# ==========================================
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value memory_limit 256M
    php_value date.timezone "Europe/Paris"
</IfModule>